<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <title>Stream Together - Room: {{ room_id }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root { --glow-color: rgb(168, 85, 247); }
        body { background-color: #000000; background-image: radial-gradient(at 20% 20%, hsla(273, 91%, 60%, 0.2) 0px, transparent 50%), radial-gradient(at 80% 20%, hsla(193, 91%, 60%, 0.2) 0px, transparent 50%), radial-gradient(at 20% 80%, hsla(333, 91%, 60%, 0.2) 0px, transparent 50%), radial-gradient(at 80% 80%, hsla(43, 91%, 60%, 0.2) 0px, transparent 50%); font-family: 'Roboto', sans-serif; }
        .spline-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        #player { border-radius: 1rem; box-shadow: 0px 30px 60px -15px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(168, 85, 247, 0.2); }
        .input-field:focus { box-shadow: 0 0 15px 2px rgba(168, 85, 247, 0.5), inset 0 2px 4px 0 rgba(0,0,0,0.5); border-color: var(--glow-color) !important; }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4); }
        #chat-messages::-webkit-scrollbar { width: 8px; }
        #chat-messages::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px;}
        #chat-messages::-webkit-scrollbar-thumb { background: var(--glow-color); border-radius: 10px; }
        #chat-messages::-webkit-scrollbar-thumb:hover { background: #a855f7; }
    </style>
</head>
<body class="text-white min-h-screen p-4">

    <div class="spline-container">
        <iframe src='https://my.spline.design/interdimensionalmessaged-6c5b9f71c172d7f57134376c7c4f45d3/' frameborder='0' width='100%' height='100%'></iframe>
    </div>
    
    {% if not is_admin %}
    <div id="waiting-overlay" class="fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50">
        <h2 class="text-3xl font-bold text-purple-400 mb-4">Awaiting Admin Approval</h2>
        <p class="text-gray-300">Your request to join has been sent. Please wait...</p>
    </div>
    {% endif %}

    <main class="w-full max-w-7xl mx-auto my-8 grid grid-cols-1 lg:grid-cols-3 gap-6 relative z-10">
        
        <div class="lg:col-span-2 bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-2xl p-4 sm:p-6 space-y-4">
            <header class="text-center">
                <h1 class="text-3xl md:text-4xl font-bold tracking-wider font-['Orbitron']">Room: {{ room_id }}</h1>
                <p class="text-md text-gray-400">{% if is_admin %}You are the <span class="text-purple-400 font-bold">Admin</span>.{% else %}You are a <span class="text-blue-400 font-bold">Viewer</span>.{% endif %}</p>
            </header>

            <div id="player-wrapper" class="aspect-video w-full bg-black rounded-lg overflow-hidden relative">
                <div id="player" class="w-full h-full"></div>

                {% if not is_admin %}
                <button id="fullscreen-btn" title="Toggle Fullscreen" class="absolute top-2 right-2 z-20 p-2 bg-black bg-opacity-40 rounded-full hover:bg-opacity-75 transition-opacity opacity-60 hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-white">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m4.5 11.25h-4.5m4.5 0v-4.5m0 0L15 15" />
                    </svg>
                </button>
                {% endif %}
            </div>

            {% if is_admin %}
            <div id="admin-controls" class="flex flex-col md:flex-row gap-4 items-center">
                <div class="relative flex-grow w-full">
                    <input type="text" id="youtube-url" class="input-field w-full bg-gray-800/70 border-2 border-gray-600 focus:border-purple-500 rounded-lg py-3 pr-3 pl-4 outline-none" placeholder="Paste a YouTube video URL...">
                </div>
                <button id="set-video-btn" class="action-button w-full md:w-auto bg-purple-600 hover:bg-purple-700 font-bold py-3 px-8 rounded-lg transition-all">
                    Set Video
                </button>
            </div>
            {% endif %}
        </div>

        <div class="lg:col-span-1 bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-2xl p-4 sm:p-6 flex flex-col max-h-[90vh]">
            {% if is_admin %}
            <div id="admin-panel">
                <h3 class="text-xl font-bold text-purple-400 border-b-2 border-gray-700 pb-2 mb-3">Participants</h3>
                <div id="user-list" class="space-y-2 mb-4 max-h-48 overflow-y-auto">
                    </div>
            </div>
            {% endif %}

            <h3 class="text-xl font-bold text-purple-400 border-b-2 border-gray-700 pb-2 mb-3">Live Chat</h3>
            <div id="chat-messages" class="flex-grow space-y-3 overflow-y-auto pr-2 mb-4">
                </div>
            <div class="flex gap-2 mt-auto">
                <input type="text" id="chat-input" placeholder="Type a message..." class="input-field flex-grow bg-gray-800/70 border-2 border-gray-600 rounded-lg py-2 px-3 outline-none">
                <button id="send-chat-btn" class="action-button bg-blue-600 hover:bg-blue-700 font-bold py-2 px-5 rounded-lg">Send</button>
            </div>
        </div>
    </main>
    
    <script src="/static/main.js"></script>

</body>
</html>